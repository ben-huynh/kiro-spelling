<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spelling Bee Practice</title>
<style>
  body {
    font-family: "Poppins", Arial, sans-serif;
    text-align: center;
    background: #fffbee;
    margin-top: 50px;
    color: #333;
  }
  h1 { color: #222; }
  input {
    font-size: 1.2rem;
    padding: 8px;
    width: 300px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  button {
    font-size: 1.1rem;
    margin: 10px;
    padding: 8px 16px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: #ffce00;
    transition: all 0.2s ease;
  }
  button:hover { background: #ffd633; }
  button:disabled { background: #ddd; cursor: not-allowed; }
  .correct { color: green; font-weight: bold; }
  .incorrect { color: red; font-weight: bold; }
  #progress {
    width: 80%;
    margin: 20px auto;
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
    height: 20px;
  }
  #bar {
    height: 100%;
    background: #4CAF50;
    width: 0%;
    transition: width 0.4s ease;
  }
  #feedback { margin: 10px; height: 40px; }
  select {
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #aaa;
    font-size: 1rem;
  }
  #missedWords {
    margin-top: 20px;
    font-size: 1rem;
    color: #c00;
  }
</style>
</head>
<body>

<h1>üêù Spelling Bee Practice</h1>

<label for="gradeSelect"><b>Select Grade:</b></label>
<select id="gradeSelect"></select>
<br><br>

<label for="voiceSelect"><b>Choose voice:</b></label>
<select id="voiceSelect"></select>
<br><br>

<p id="prompt">Press "Start" to begin!</p>

<input
  id="answer"
  type="text"
  placeholder="Type the word..."
  disabled
  autocomplete="off"
  autocorrect="off"
  autocapitalize="off"
  spellcheck="false"
/>
<br>
<button id="start">Start</button>
<button id="repeat" disabled>üîÅ Repeat Word</button>
<button id="submit" disabled>Submit</button>

<div id="feedback"></div>

<div id="progress">
  <div id="bar"></div>
</div>

<p id="score">Score: 0 / 0</p>
<div id="missedWords"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

// --- Word Lists ---
const wordLists = {
  "4th Grade": [
    "hesitate","scorcher","scavenger","fragments","deflated","unleash",
    "ration","cosmetics","crawdad","frustration","unruly","mascot",
    "aroma","moustache","mustache","artifacts","artefacts","perfume",
    "discoveries","sinister","tuxedo","prognosis","lurches","language",
    "gallop","buffalo","sequins","fluently","fabulous","lanky",
    "sardines","mysterious","brandished","rickety","anguish","conical",
    "porridge","lilt","pediatric","beige","democracy","rummage",
    "gaunt","ancestral","grimace","nautical","enormous","geranium",
    "foreign","dubious","ebony","paltry"
  ],
  "5th Grade": [
    "verdict","garbled","encourages","imitation","miniature","receptionist",
    "preamble","plausible","reprimanding","commotion","oblivion","immigrants",
    "steeple","spectators","lanyards","suspicious","parchment","ramshackle",
    "fugitive","heron","dissolving","nomad","billowed","skewer","Berlin",
    "lunacy","conjure","bracken","noggin","neon","rakish","hypnosis",
    "rotunda","gusto","toiletries","gleaned","jeered","winsome","prattling",
    "galore","emporium","atrium","eccentric","savant","almanac","hippies",
    "samosas","campaign","pistachio","mosque"
  ],
  "6th Grade": [
    "zombielike","warlock","colossus","convulsively","dimensional","garishly",
    "graffitist","Everest","dexterity","cavorting","marauder","conscience",
    "battlements","deferential","albatross","khaki","opalescent","asphalt",
    "Yiddish","talcum","tranquilizer","equestrian","plaited","monsieur",
    "manticores","prestigious","fraidycat","guttural","lo","mein","courier",
    "sans","serif","psyche","stucco","Frankenstein","schema","et","cetera",
    "vidimus","delphine","slough","archipelago","serape","puissance",
    "pinioning","chignon","pheromone","galleon","magnanimous","chartreuse",
    "wainscoting","Nehru"
  ],
  "7th Grade": [
    "gangly","swaggering","chimneys","riveted","plaid","dirge","zeal",
    "whittled","depots","fiberglass","salvaged","fissures","enthusiastic",
    "discipline","unfamiliar","scurrying","dignitaries","pizzeria","dismissal",
    "skittish","careened","nomination","opportunist","dictatorship","comrades",
    "sporadic","promenade","repugnant","invincible","renowned","parachute",
    "laborious","appointment","foreseeable","ratify","scalpel","reclusive",
    "compassionate","bulletin","alfalfa","officially","confidant","bayonet",
    "amicable","exuberant","beautician","equations","assignment","ultimatum",
    "whinnying"
  ],
  "8th Grade": [
    "squalor","memoirs","cylinders","ominous","muffler","syndrome","premises",
    "safari","lasagna","substantially","mercantile","formidable","propaganda",
    "marquee","proficient","compunction","emphatically","hyperventilated",
    "ostracism","onslaught","ruefully","misanthrope","prototype","cravenly",
    "mulberry","hypocritical","chlorine","traumatic","receipts","solemnly",
    "begrudge","contentious","precocious","ensemble","cadre","lye","belfry",
    "lacrosse","sluice","cajolery","vigilance","residuals","boutique",
    "peroxide","aristocracy","apocalypse","tuberculosis","barricade","confreres",
    "anonymously","unparalleled","barrette","chassis","junket","quandary",
    "Erie","gingham","silhouette","auxiliary","thesaurus","patriarchs",
    "chandelier","dulce","concierge","latticework","hibiscus","tamale","maracas",
    "gyroplane","burpees","Adriatic","piccolo","au","revoir","tulle","boll",
    "weevil","camphor","Tucson","paparazzi","pumpernickel","pogrom"
  ]
};

// --- State Variables ---
let selectedGrade = "4th Grade";
let words = [...wordLists[selectedGrade]];
let shuffled = []; // Will hold the randomized word list
let currentIndex = 0;
let score = 0;
let currentWord = "";
let missed = []; // Stores missed words for display
let synth = window.speechSynthesis;
let voices = [];
let selectedVoice = null;

// --- UI Elements ---
const prompt = document.getElementById("prompt");
const answer = document.getElementById("answer");
const feedback = document.getElementById("feedback");
const scoreDisplay = document.getElementById("score");
const startBtn = document.getElementById("start");
const submitBtn = document.getElementById("submit");
const repeatBtn = document.getElementById("repeat");
const bar = document.getElementById("bar");
const voiceSelect = document.getElementById("voiceSelect");
const gradeSelect = document.getElementById("gradeSelect");
const missedWords = document.getElementById("missedWords");

// --- Utility Functions ---

// Fisher-Yates (Knuth) Shuffle for randomization
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function speakWord(word) {
    if (!synth || !selectedVoice) {
        // Fallback if TTS isn't ready
        alert("Text-to-speech not fully loaded. Try selecting a voice.");
        return;
    }
    synth.cancel();
    const utterance = new SpeechSynthesisUtterance(word);
    utterance.voice = selectedVoice;
    utterance.rate = 0.7; // Standard speed or slightly slower
    utterance.pitch = 1;
    synth.speak(utterance);
}

function resetGame() {
    shuffled = [];
    currentIndex = 0;
    score = 0;
    missed = [];
    currentWord = "";
    feedback.textContent = "";
    scoreDisplay.textContent = `Score: 0 / 0`;
    missedWords.innerHTML = "";
    bar.style.width = '0%';
    prompt.textContent = "Press \"Start\" to begin!";
    answer.value = "";
    answer.disabled = true;
    submitBtn.disabled = true;
    repeatBtn.disabled = true;
    startBtn.textContent = "Start";
    startBtn.disabled = false;
}

function updateProgress() {
    const total = shuffled.length;
    const correctCount = score;
    
    // Progress bar shows how many words are correct
    const percentage = total > 0 ? (correctCount / total) * 100 : 0;
    bar.style.width = `${percentage}%`;
    
    // Score shows correct count out of total words completed (currentIndex)
    scoreDisplay.textContent = `Score: ${correctCount} / ${currentIndex}`;

    // Show all the words that were missed
    if (missed.length > 0) {
        missedWords.innerHTML = '<strong>Missed Words:</strong><br>' + 
            missed.map(item => `<span style="text-decoration: line-through;">${item.attempt}</span> &rarr; ${item.word}`).join(', ');
    } else {
        missedWords.textContent = '';
    }
}

function endGame() {
    updateProgress();
    const finalScore = `${score} / ${shuffled.length}`;
    prompt.textContent = `üéâ Game Over! Final Score: ${finalScore}`;
    startBtn.textContent = "Play Again";
    answer.disabled = true;
    submitBtn.disabled = true;
    repeatBtn.disabled = true;
}

function nextWord() {
    if (currentIndex >= shuffled.length) {
        endGame();
        return;
    }

    currentWord = shuffled[currentIndex];
    prompt.textContent = `Word ${currentIndex + 1} of ${shuffled.length}: Listen carefully.`;
    answer.value = "";
    answer.disabled = false;
    submitBtn.disabled = false;
    repeatBtn.disabled = false;
    answer.focus();

    speakWord(currentWord);

    updateProgress();
}

function checkSpelling() {
    // Disable buttons to prevent double-submitting
    submitBtn.disabled = true; 
    answer.disabled = true;
    repeatBtn.disabled = true;

    const submission = answer.value.trim().toLowerCase();
    const correct = currentWord.toLowerCase();

    if (submission === correct) {
        feedback.className = "correct";
        feedback.textContent = `‚úÖ Correct! It's ${currentWord}.`;
        score++;
    } else {
        feedback.className = "incorrect";
        feedback.textContent = `‚ùå Incorrect. The correct spelling is ${currentWord}.`;
        missed.push({ word: currentWord, attempt: answer.value.trim() }); // Keep the user's attempt
    }

    currentIndex++;

    // Wait a moment, then move to the next word or end the game
    setTimeout(() => {
        feedback.textContent = "";
        nextWord();
    }, 2000);
}


// --- Voice and Grade Dropdown Setup ---

function populateVoiceList() {
    voices = synth.getVoices();
    voiceSelect.innerHTML = ''; 

    // Filter for English voices
    let engVoices = voices.filter(v => v.lang.startsWith('en'));
    let defaultVoice = engVoices.find(v => v.name.includes('Google US English') || v.name.includes('Microsoft David'));

    engVoices.forEach((voice, i) => {
        const option = document.createElement("option");
        option.textContent = `${voice.name} (${voice.lang})`;
        option.value = i;
        voiceSelect.appendChild(option);
    });

    // Set default selected voice
    if (defaultVoice) {
        const defaultIndex = voices.findIndex(v => v.name === defaultVoice.name && v.lang === defaultVoice.lang);
        voiceSelect.value = defaultIndex !== -1 ? defaultIndex : (engVoices.length > 0 ? engVoices[0].value : 0);
        selectedVoice = defaultVoice;
    } else if (engVoices.length > 0) {
        selectedVoice = engVoices[0]; 
        voiceSelect.value = 0;
    } else {
        selectedVoice = voices[0] || null;
    }
}

// Critical: Voices load asynchronously, listen for 'voiceschanged' event.
if (synth.onvoiceschanged !== undefined) {
    synth.onvoiceschanged = populateVoiceList;
} else {
    populateVoiceList(); // Fallback
}

voiceSelect.addEventListener("change", () => {
    const voiceIndex = parseInt(voiceSelect.value);
    selectedVoice = voices[voiceIndex];
});

// Populate grade dropdown
for (const grade in wordLists) {
    const option = document.createElement("option");
    option.value = grade;
    option.textContent = grade;
    gradeSelect.appendChild(option);
}
gradeSelect.value = selectedGrade;

gradeSelect.addEventListener("change", () => {
    selectedGrade = gradeSelect.value;
    words = [...wordLists[selectedGrade]]; // Update words list
    resetGame();
});


// --- Event Handlers ---

// Start Button
startBtn.addEventListener("click", () => {
    if (startBtn.textContent === "Start" || startBtn.textContent === "Play Again") {
        resetGame();
        // WORDS ARE RANDOMIZED: Shuffle the current word list
        shuffled = shuffleArray([...words]);
        nextWord();
        startBtn.textContent = "Restart";
    } else if (startBtn.textContent === "Restart") {
        resetGame();
    }
});

// Submit Button
submitBtn.addEventListener("click", checkSpelling);

// Repeat Word Button (Updated from 'Hear Word')
repeatBtn.addEventListener("click", () => {
    if (currentWord) {
        speakWord(currentWord);
    }
});

// SUBMIT AND ENTER HAVE THE SAME ACTION: Listen for 'Enter' key in the textbox
answer.addEventListener("keypress", (e) => {
    // Check if the key is 'Enter' (key code 13 for older browsers, key property for modern)
    if ((e.key === "Enter" || e.keyCode === 13) && !submitBtn.disabled) {
        e.preventDefault(); // Prevent the default form submission/line break
        checkSpelling();
    }
});

// Initial game state setup
resetGame();

});
</script>
</body>
</html>
